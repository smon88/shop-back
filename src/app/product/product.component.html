@if (isLoading()) {
  <app-loading />
} @else {
<main class="my-16 max-w-screen-lg mx-auto px-6 animate-fade-in">
  <section class="card flex flex-col md:flex-row gap-4 overflow-hidden">
    <article class="flex flex-col bg-gray-100 dark:bg-slate-700 p-6">
      <!-- Imagen principal -->
      <div class="relative size-64 sm:size-72 lg:size-96 transition-transform duration-500 hover:scale-105 mx-auto">
        @if (currentImage) {
        <img
          class="object-contain object-center w-full h-full"
          [src]="getFullImageUrl(currentImage)"
          alt="Product Image"
        />
        } @else if (product?.urlImg) {
        <img
          class="object-contain object-center"
          [ngSrc]="product?.urlImg ?? ''"
          alt="Product Image"
          priority
          fill
        />
        } @else {
        <img
          priority
          fill
          ngSrc="/img/placeholder.jpg"
          alt="Placeholder Image"
        />
        }
      </div>

      <!-- Miniaturas de la galerÃ­a -->
      @if (allImages.length > 1) {
      <div class="flex justify-center gap-2 mt-4">
        @for (image of allImages; track $index; let i = $index) {
        <button
          type="button"
          (click)="selectImage(i)"
          class="relative w-16 h-16 rounded-lg overflow-hidden border-2 transition-all duration-200 hover:opacity-100"
          [class.border-blue-500]="selectedImageIndex === i"
          [class.border-transparent]="selectedImageIndex !== i"
          [class.opacity-60]="selectedImageIndex !== i"
        >
          <img
            [src]="getFullImageUrl(image)"
            [alt]="'Imagen ' + (i + 1)"
            class="w-full h-full object-cover"
          />
        </button>
        }
      </div>
      }
    </article>
    <article class="p-6">
      <h1 class="font-bold text-3xl text-gray-900 dark:text-white">{{ product?.name }}</h1>
      <div class="flex gap-2 mt-3">
        <div class="flex items-center gap-1">
          <svg
            class="size-4 text-yellow-300"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
          >
            <path
              d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"
            />
          </svg>
          <svg
            class="size-4 text-yellow-300"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
          >
            <path
              d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"
            />
          </svg>
          <svg
            class="size-4 text-yellow-300"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
          >
            <path
              d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"
            />
          </svg>
          <svg
            class="size-4 text-yellow-300"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
          >
            <path
              d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"
            />
          </svg>
          <svg
            class="size-4 text-yellow-300"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 576 512"
          >
            <path
              d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"
            />
          </svg>
        </div>
        <p class="border-l border-gray-500 text-gray-500 ps-2 text-sm">
          {{ product?.reviews }} reviews
        </p>
      </div>
      <div class="mt-5 items-baseline font-bold">
        <h3 class="text-3xl md:text-5xl text-gray-900 dark:text-white">{{ product?.price | copCurrency }}</h3>
        @if (product?.previousPrice) {
        <h3 class="text-gray-500 dark:text-gray-400 text-xl md:text-2xl line-through">
          {{ product?.previousPrice | copCurrency }}
        </h3>
        }
      </div>
      <div
        class="mt-5 text-gray-500 dark:text-gray-400 format-strong:text-gray-700 dark:format-strong:text-gray-300 format-li:mb-2 format-p:mb-4"
        [innerHTML]="product?.description"
      ></div>
      <div class="mt-5 flex gap-2">
        <button
          (click)="addToCart()"
          class="btn-primary w-full"
        >
          Add To Cart
        </button>
        <button
          type="button"
          class="py-2 px-4 inline-flex items-center justify-center text-gray-500 dark:text-gray-400 hover:text-red-500 dark:hover:text-red-400 bg-gray-100 dark:bg-slate-700 hover:bg-red-50 dark:hover:bg-red-900/20 focus:ring-4 focus:ring-gray-100 dark:focus:ring-slate-600 rounded-lg transition-all duration-300"
        >
          <svg
            class="size-6"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12.01 6.001C6.5 1 1 8 5.782 13.001L12.011 20l6.23-7C23 8 17.5 1 12.01 6.002Z"
            />
          </svg>
        </button>
      </div>
    </article>
  </section>
</main>
@if (showSuccessToast) {
<div
  id="toast-success"
  class="fixed right-5 bottom-5 flex items-center w-full max-w-xs p-4 text-gray-500 dark:text-gray-300 bg-white dark:bg-slate-800 rounded-lg shadow-lg animate-slide-up border border-gray-100 dark:border-slate-700"
  role="alert"
>
  <div
    class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-green-500 bg-green-100 rounded-lg"
  >
    <svg 
      class="w-5 h-5"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      viewBox="0 0 640 640"
      >
      <path d="M320 576C178.6 576 64 461.4 64 320C64 178.6 178.6 64 320 64C461.4 64 576 178.6 576 320C576 461.4 461.4 576 320 576zM438 209.7C427.3 201.9 412.3 204.3 404.5 215L285.1 379.2L233 327.1C223.6 317.7 208.4 317.7 199.1 327.1C189.8 336.5 189.7 351.7 199.1 361L271.1 433C276.1 438 282.9 440.5 289.9 440C296.9 439.5 303.3 435.9 307.4 430.2L443.3 243.2C451.1 232.5 448.7 217.5 438 209.7z"/>
    </svg>
    <span class="sr-only">Success icon</span>
  </div>
  <div class="ms-3 text-sm font-normal">
    Producto agregado correctamente
  </div>
  <button
    (click)="showSuccessToast = false"
    type="button"
    class="ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg focus:ring-2 focus:ring-gray-300 p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8"
    data-dismiss-target="#toast-danger"
    aria-label="Close"
  >
    <span class="sr-only">Close</span>
    <svg
      class="w-3 h-3"
      aria-hidden="true"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 14 14"
    >
      <path
        stroke="currentColor"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
      />
    </svg>
  </button>
</div>
}
}
